<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Share - Local File Access (100GB+ Support)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .audio-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #ecf0f1;
            text-align: center;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-weight: 500;
            color: #bdc3c7;
            font-size: 0.9em;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #e74c3c, #f39c12, #27ae60);
            outline: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .equalizer-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .eq-bands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .eq-band {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .eq-band label {
            font-size: 0.8em;
            font-weight: bold;
            color: #bbb;
        }

        .eq-slider {
            writing-mode: bt-lr;
            writing-mode: vertical-lr;
            width: 5px;
            height: 100px;
            background: linear-gradient(to top, #e74c3c, #f39c12, #27ae60);
            border-radius: 5px;
            appearance: none;
            cursor: pointer;
        }

        .eq-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer;
        }

        .eq-value {
            font-size: 0.7em;
            color: #ecf0f1;
            font-weight: bold;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .preset-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .preset-btn.active {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .music-library {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 200px;
        }

        .music-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .music-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .track-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .track-meta {
            color: #bdc3c7;
            font-size: 0.9em;
        }

        .progress-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
            cursor: pointer;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar:hover {
            height: 14px;
            transition: height 0.2s ease;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            width: 0%;
            transition: width 0.1s ease;
            position: relative;
        }

        .progress-handle {
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            cursor: grab;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .progress-bar:hover .progress-handle {
            opacity: 1;
        }

        .progress-handle:active {
            cursor: grabbing;
            transform: translateY(-50%) scale(1.2);
        }

        .progress-bar:hover .progress-fill {
            box-shadow: 0 0 8px rgba(39, 174, 96, 0.5);
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Circular Bass/Treble Controls */
        .bass-treble-controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .circular-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .circular-knob {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            border: 3px solid #3498db;
            position: relative;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
        }

        .circular-knob:hover {
            border-color: #2ecc71;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
            transform: scale(1.05);
        }

        .knob-indicator {
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 20px;
            background: #e74c3c;
            border-radius: 2px;
            transform-origin: bottom center;
            transition: transform 0.2s ease;
        }

        .knob-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #34495e;
            border-radius: 50%;
            border: 2px solid #3498db;
        }

        .knob-value {
            font-size: 1.1em;
            font-weight: 600;
            color: #3498db;
            text-align: center;
            min-width: 60px;
        }

        .knob-label {
            font-size: 0.9em;
            opacity: 0.8;
            text-align: center;
            margin-top: 5px;
        }

        .knob-percentage {
            font-size: 0.8em;
            opacity: 0.7;
            text-align: center;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .title {
                font-size: 1.8em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .eq-bands {
                grid-template-columns: repeat(5, 1fr);
                gap: 10px;
            }
            
            .eq-slider {
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üéµ Music Share</h1>
            <p class="subtitle">Local File Access with 100GB+ Support</p>
        </div>

        <div class="controls">
            <button class="btn" onclick="selectMusicFolder()">
                üìÅ Select Music Folder
            </button>
            <button class="btn btn-secondary" onclick="selectMusicFiles()">
                üéµ Select Music Files
            </button>
            <button class="btn btn-success" onclick="showAudioSettings()">
                üéõÔ∏è Audio Settings
            </button>
        </div>

        <!-- Music Library (positioned above music player) -->
        <div class="music-library">
            <h3>üéµ Your Music Library</h3>
            <div id="musicLibrary">
                <p style="text-align: center; opacity: 0.7; padding: 20px;">
                    No music files loaded. Use the buttons above to add your music collection.
                </p>
            </div>
        </div>

        <!-- Music Player Controls -->
        <div class="audio-controls">
            <div class="control-section">
                <div class="control-title">üéµ Music Player</div>
                
                <!-- Now Playing Display -->
                <div id="nowPlayingInfo" style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; display: none;">
                    <div id="currentTrackName" style="font-size: 1.1em; font-weight: 600; margin-bottom: 5px;">No track selected</div>
                    <div id="currentTrackMeta" style="font-size: 0.9em; opacity: 0.8;">Select a track to start playing</div>
                </div>

                <!-- Playback Controls -->
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn" onclick="previousTrack()" style="padding: 12px 18px; font-size: 20px;">‚èÆÔ∏è</button>
                    <button class="btn" onclick="rewind10()" style="padding: 12px 15px; font-size: 16px;">‚è™</button>
                    <button class="btn btn-success" onclick="togglePlayPause()" id="playPauseBtn" style="padding: 15px 20px; font-size: 24px;">‚ñ∂Ô∏è</button>
                    <button class="btn" onclick="forward10()" style="padding: 12px 15px; font-size: 16px;">‚è©</button>
                    <button class="btn" onclick="nextTrack()" style="padding: 12px 18px; font-size: 20px;">‚è≠Ô∏è</button>
                </div>

                <!-- Progress Bar -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span id="currentTime" style="font-size: 0.9em; opacity: 0.8;">0:00</span>
                        <span id="totalTime" style="font-size: 0.9em; opacity: 0.8;">0:00</span>
                    </div>
                    <div class="progress-bar" id="progressBarContainer" 
                         onmousedown="startDrag(event)" 
                         onclick="seekTo(event)"
                         onmousemove="showPreview(event)"
                         onmouseleave="hidePreview()">
                        <div class="progress-fill" id="progressBar">
                            <div class="progress-handle" id="progressHandle"></div>
                        </div>
                        <div id="timePreview" style="position: absolute; top: -35px; background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; display: none; pointer-events: none; transform: translateX(-50%);"></div>
                    </div>
                </div>

                <!-- Additional Controls -->
                <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label style="font-size: 0.9em;">üîä Volume:</label>
                        <input type="range" class="slider" id="volumeSlider" min="0" max="100" step="1" value="70" style="width: 100px;" oninput="setVolume(this.value)">
                        <span id="volumeValue" style="font-size: 0.8em; min-width: 35px;">70%</span>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="toggleShuffle()" id="shuffleBtn" style="padding: 8px 12px; font-size: 14px;">üîÄ</button>
                        <button class="btn btn-secondary" onclick="toggleRepeat()" id="repeatBtn" style="padding: 8px 12px; font-size: 14px;">üîÅ</button>
                        <button class="btn btn-secondary" onclick="toggleMute()" id="muteBtn" style="padding: 8px 12px; font-size: 14px;">üîä</button>
                    </div>
                </div>

                <!-- Speed Control -->
                <div style="margin-top: 15px; text-align: center;">
                    <div style="display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <label style="font-size: 0.9em;">‚ö° Speed:</label>
                        <button class="preset-btn" onclick="setPlaybackSpeed(0.5)" style="padding: 5px 10px;">0.5x</button>
                        <button class="preset-btn" onclick="setPlaybackSpeed(0.75)" style="padding: 5px 10px;">0.75x</button>
                        <button class="preset-btn active" onclick="setPlaybackSpeed(1.0)" id="normalSpeedBtn" style="padding: 5px 10px;">1.0x</button>
                        <button class="preset-btn" onclick="setPlaybackSpeed(1.25)" style="padding: 5px 10px;">1.25x</button>
                        <button class="preset-btn" onclick="setPlaybackSpeed(1.5)" style="padding: 5px 10px;">1.5x</button>
                        <button class="preset-btn" onclick="setPlaybackSpeed(2.0)" style="padding: 5px 10px;">2.0x</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-section" id="progressSection">
            <h3 id="progressTitle">Processing Files...</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Ready to process files...</p>
        </div>

        <!-- Pre-Amplifier & DAC Control -->
        <div class="audio-controls">
            <div class="control-section">
                <div class="control-title">üéõÔ∏è Pre-Amplifier & DAC Control</div>
                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Pre-Amp Gain: <span id="preampValue">0 dB</span></div>
                        <input type="range" class="slider" id="preampGain" min="-20" max="20" step="1" value="0" oninput="setPreampGain(this.value)">
                    </div>
                    <div class="control-item">
                        <div class="control-label">Bass: <span id="bassValue">0 dB</span></div>
                        <input type="range" class="slider" id="bassSlider" min="-20" max="20" step="1" value="0" oninput="setBass(this.value)">
                    </div>
                    <div class="control-item">
                        <div class="control-label">Treble: <span id="trebleValue">0 dB</span></div>
                        <input type="range" class="slider" id="trebleSlider" min="-20" max="20" step="1" value="0" oninput="setTreble(this.value)">
                    </div>
                </div>
            </div>
        </div>

        <!-- 10-Band Equalizer -->
        <div class="equalizer-section">
            <div class="control-title">üéõÔ∏è 10-Band Equalizer</div>
            
            <div class="preset-buttons">
                <button class="preset-btn active" onclick="setEQPreset('flat')">Flat</button>
                <button class="preset-btn" onclick="setEQPreset('rock')">üé∏ Rock</button>
                <button class="preset-btn" onclick="setEQPreset('pop')">üéµ Pop</button>
                <button class="preset-btn" onclick="setEQPreset('jazz')">üé∫ Jazz</button>
                <button class="preset-btn" onclick="setEQPreset('classical')">üéº Classical</button>
                <button class="preset-btn" onclick="setEQPreset('electronic')">üéπ Electronic</button>
                <button class="preset-btn" onclick="setEQPreset('bass')">üîä Bass Boost</button>
            </div>
            
            <div class="preset-buttons" style="margin-top: 10px;">
                <button class="preset-btn" onclick="setEQPreset('bass-boost')">üî• Bass Boost+</button>
                <button class="preset-btn" onclick="setEQPreset('super-bass')">üí• Super Bass</button>
                <button class="preset-btn" onclick="setEQPreset('vocal-boost')">üé§ Vocal Boost</button>
                <button class="preset-btn" onclick="setEQPreset('treble-boost')">‚ú® Treble Boost</button>
                <button class="preset-btn" onclick="setEQPreset('v-shape')">üî≥ V-Shape</button>
                <button class="preset-btn" onclick="setEQPreset('loudness')">üì¢ Loudness</button>
            </div>
            
            <div class="preset-buttons" style="margin-top: 10px;">
                <button class="preset-btn" onclick="setEQPreset('acoustic')">üéª Acoustic</button>
                <button class="preset-btn" onclick="setEQPreset('hip-hop')">üéµ Hip-Hop</button>
                <button class="preset-btn" onclick="setEQPreset('r&b')">üé∂ R&B</button>
                <button class="preset-btn" onclick="setEQPreset('metal')">ü§ò Metal</button>
                <button class="preset-btn" onclick="setEQPreset('dance')">üíÉ Dance</button>
                <button class="preset-btn" onclick="setEQPreset('reggae')">üå¥ Reggae</button>
                <button class="preset-btn" onclick="setEQPreset('country')">ü§† Country</button>
            </div>
            
            <div class="eq-bands">
                <div class="eq-band">
                    <label>32Hz</label>
                    <input type="range" class="eq-slider" id="eq32" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(32, this.value)">
                    <span class="eq-value" id="eq32Value">0dB</span>
                </div>
                <div class="eq-band">
                    <label>64Hz</label>
                    <input type="range" class="eq-slider" id="eq64" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(64, this.value)">
                    <span class="eq-value" id="eq64Value">0dB</span>
                </div>
                <div class="eq-band">
                    <label>125Hz</label>
                    <input type="range" class="eq-slider" id="eq125" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(125, this.value)">
                    <span class="eq-value" id="eq125Value">0dB</span>
                </div>
                <div class="eq-band">
                    <label>250Hz</label>
                    <input type="range" class="eq-slider" id="eq250" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(250, this.value)">
                    <span class="eq-value" id="eq250Value">0dB</span>
                </div>
                <div class="eq-band">
                    <label>500Hz</label>
                    <input type="range" class="eq-slider" id="eq500" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(500, this.value)">
                    <span class="eq-value" id="eq500Value">0dB</span>
                </div>
                <div class="eq-band">
                    <label>1kHz</label>
                    <input type="range" class="eq-slider" id="eq1k" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(1000, this.value)">
                    <span class="eq-value" id="eq1kValue">0dB</span>
                </div>
                <div class="eq-band">
                    <label>2kHz</label>
                    <input type="range" class="eq-slider" id="eq2k" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(2000, this.value)">
                    <span class="eq-value" id="eq2kValue">0dB</span>
                </div>
                <div class="eq-band">
                    <label>4kHz</label>
                    <input type="range" class="eq-slider" id="eq4k" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(4000, this.value)">
                    <span class="eq-value" id="eq4kValue">0dB</span>
                </div>
                <div class="eq-band">
                    <label>8kHz</label>
                    <input type="range" class="eq-slider" id="eq8k" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(8000, this.value)">
                    <span class="eq-value" id="eq8kValue">0dB</span>
                </div>
                <div class="eq-band">
                    <label>16kHz</label>
                    <input type="range" class="eq-slider" id="eq16k" min="-12" max="12" step="0.5" value="0" oninput="updateEQBand(16000, this.value)">
                    <span class="eq-value" id="eq16kValue">0dB</span>
                </div>
            </div>
        </div>

        <!-- AI Audio Enhancer -->
        <div class="audio-controls">
            <div class="control-section">
                <div class="control-title">ü§ñ AI Audio Enhancer</div>
                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Bit Depth Upscaling: <span id="bitDepthValue">16-bit</span></div>
                        <select id="bitDepth" onchange="setBitDepth(this.value)">
                            <option value="16">16-bit (Original)</option>
                            <option value="24">24-bit (Enhanced)</option>
                            <option value="32">32-bit (Ultra)</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <div class="control-label">Sample Rate: <span id="sampleRateValue">44.1kHz</span></div>
                        <select id="sampleRate" onchange="setSampleRate(this.value)">
                            <option value="44100">44.1kHz (CD Quality)</option>
                            <option value="48000">48kHz (Studio)</option>
                            <option value="96000">96kHz (Hi-Res)</option>
                            <option value="192000">192kHz (Ultra)</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Noise Reduction: <span id="noiseReductionValue">0%</span></div>
                        <input type="range" class="slider" id="noiseReduction" min="0" max="100" step="5" value="0" oninput="setNoiseReduction(this.value)">
                    </div>
                    <div class="control-item">
                        <div class="control-label">Dynamic Range: <span id="dynamicRangeValue">100%</span></div>
                        <input type="range" class="slider" id="dynamicRange" min="0" max="200" step="5" value="100" oninput="setDynamicRange(this.value)">
                    </div>
                </div>

                <div class="preset-buttons">
                    <button class="preset-btn active" onclick="setAIPreset('off')">Off</button>
                    <button class="preset-btn" onclick="setAIPreset('mild')">üéµ Mild Enhancement</button>
                    <button class="preset-btn" onclick="setAIPreset('moderate')">üéõÔ∏è Moderate</button>
                    <button class="preset-btn" onclick="setAIPreset('aggressive')">üöÄ Aggressive</button>
                    <button class="preset-btn" onclick="setAIPreset('audiophile')">üéß Audiophile</button>
                </div>
            </div>
        </div>

        <!-- AI Audio Upscaling -->
        <div class="audio-controls">
            <div class="control-section">
                <div class="control-title">üöÄ AI Audio Upscaling</div>
                <div style="margin-bottom: 15px;">
                    <p style="font-size: 0.9em; opacity: 0.8; text-align: center;">
                        Enhance low-quality audio files using advanced AI algorithms
                    </p>
                </div>
                
                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Upscaling Mode: <span id="upscalingModeValue">Real-Time</span></div>
                        <select id="upscalingMode" onchange="setUpscalingMode(this.value)">
                            <option value="realtime">Real-Time Processing</option>
                            <option value="batch">Batch Processing</option>
                            <option value="adaptive">Adaptive AI</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <div class="control-label">Quality Target: <span id="qualityTargetValue">Studio</span></div>
                        <select id="qualityTarget" onchange="setQualityTarget(this.value)">
                            <option value="cd">CD Quality (16-bit/44.1kHz)</option>
                            <option value="studio">Studio Quality (24-bit/96kHz)</option>
                            <option value="master">Master Quality (32-bit/192kHz)</option>
                            <option value="ultra">Ultra HD (32-bit/384kHz)</option>
                        </select>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Frequency Restoration: <span id="freqRestorationValue">50%</span></div>
                        <input type="range" class="slider" id="freqRestoration" min="0" max="100" step="5" value="50" oninput="setFreqRestoration(this.value)">
                    </div>
                    <div class="control-item">
                        <div class="control-label">Harmonic Enhancement: <span id="harmonicEnhanceValue">30%</span></div>
                        <input type="range" class="slider" id="harmonicEnhance" min="0" max="100" step="5" value="30" oninput="setHarmonicEnhance(this.value)">
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Stereo Widening: <span id="stereoWideningValue">0%</span></div>
                        <input type="range" class="slider" id="stereoWidening" min="0" max="100" step="5" value="0" oninput="setStereoWidening(this.value)">
                    </div>
                    <div class="control-item">
                        <div class="control-label">AI Intensity: <span id="aiIntensityValue">Medium</span></div>
                        <input type="range" class="slider" id="aiIntensity" min="1" max="5" step="1" value="3" oninput="setAIIntensity(this.value)">
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-item">
                        <div class="control-label">Artifact Reduction: <span id="artifactReductionValue">High</span></div>
                        <select id="artifactReduction" onchange="setArtifactReduction(this.value)">
                            <option value="off">Off</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="ultra">Ultra</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <div class="control-label">Processing Latency: <span id="processingLatencyValue">Balanced</span></div>
                        <select id="processingLatency" onchange="setProcessingLatency(this.value)">
                            <option value="low">Low Latency</option>
                            <option value="balanced">Balanced</option>
                            <option value="quality">Quality Priority</option>
                        </select>
                    </div>
                </div>

                <div class="preset-buttons">
                    <button class="preset-btn active" onclick="setUpscalingPreset('off')">Off</button>
                    <button class="preset-btn" onclick="setUpscalingPreset('mp3-enhance')">üìª MP3 Enhance</button>
                    <button class="preset-btn" onclick="setUpscalingPreset('vocal-focus')">üé§ Vocal Focus</button>
                    <button class="preset-btn" onclick="setUpscalingPreset('instrumental')">üéπ Instrumental</button>
                    <button class="preset-btn" onclick="setUpscalingPreset('maximum')">üî• Maximum</button>
                </div>

                <div style="margin-top: 20px;">
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="toggleUpscalingRealtime()">
                            <span id="realtimeToggleText">Enable Real-time</span>
                        </button>
                        <button class="btn btn-success" onclick="processCurrentTrack()">
                            Process Current Track
                        </button>
                        <button class="btn" onclick="resetUpscalingSettings()">
                            Reset Settings
                        </button>
                    </div>
                </div>

                <div id="upscalingStatus" style="margin-top: 15px; text-align: center; opacity: 0.8; display: none;">
                    <div style="font-size: 0.9em; margin-bottom: 10px;">
                        AI Processing: <span id="processingStatus">Ready</span>
                    </div>
                    <div class="progress-bar" style="height: 4px;">
                        <div class="progress-fill" id="upscalingProgress"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hidden Audio Player -->
        <audio id="audioPlayer" preload="auto" crossorigin="anonymous" style="display: none;"></audio>

        <div class="footer">
            <div style="text-align: center; margin-bottom: 15px;">
                <h4>üéµ Advanced Music Player with AI Enhancement</h4>
                <p style="opacity: 0.8; margin: 5px 0;">Professional audio processing ‚Ä¢ Hi-Res codec support ‚Ä¢ Real-time AI upscaling</p>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <div style="text-align: left;">
                    <p><strong>Features:</strong></p>
                    <p style="font-size: 0.9em; opacity: 0.8;">‚Ä¢ 10-Band Equalizer ‚Ä¢ AI Audio Upscaling</p>
                    <p style="font-size: 0.9em; opacity: 0.8;">‚Ä¢ Pre-Amplifier ‚Ä¢ Bass/Treble Control</p>
                    <p style="font-size: 0.9em; opacity: 0.8;">‚Ä¢ M4A/FLAC/Hi-Res Support</p>
                </div>
                
                <div style="text-align: center;">
                    <p><strong>Designed by AjayMallesh¬©Ô∏è</strong></p>
                    <p style="font-size: 0.9em; opacity: 0.8;">Advanced Audio Processing Engine</p>
                    <p style="font-size: 0.9em; opacity: 0.8;">Version 2.0.0 - July 31, 2025</p>
                </div>
                
                <div style="text-align: right;">
                    <p><strong>Audio Formats:</strong></p>
                    <p style="font-size: 0.9em; opacity: 0.8;">MP3 ‚Ä¢ FLAC ‚Ä¢ M4A ‚Ä¢ WAV</p>
                    <p style="font-size: 0.9em; opacity: 0.8;">OGG ‚Ä¢ AAC ‚Ä¢ Hi-Res Audio</p>
                    <p style="font-size: 0.9em; opacity: 0.8;">Up to 32-bit/384kHz</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                <p><strong>Designed by AjayMallesh¬©Ô∏è</strong></p>
                <p style="margin: 8px 0;">‡≤µ‡≤ø‡≤®‡≥ç‡≤Ø‡≤æ‡≤∏ : ‡≤Ö‡≤ú‡≤Ø‡≥ç ‡≤Æ‡≤≤‡≥ç‡≤≤‡≥á‡≤∂‡≥ç ¬©Ô∏è | ‡≤Æ‡≥ä‡≤¶‡≤≤ ‡≤Ü‡≤µ‡≥É‡≤§‡≥ç‡≤§‡≤ø | ‡≤∏‡≤ø‡≤∞‡≤ø‡≤ó‡≤®‡≥ç‡≤®‡≤°‡≤Ç ‡≤ó‡≥Ü‡≤≤‡≥ç‡≤ó‡≥Ü ‡≤∏‡≤ø‡≤∞‡≤ø‡≤ó‡≤®‡≥ç‡≤®‡≤°‡≤Ç ‡≤¨‡≤æ‡≤≥‡≥ç‡≤ó‡≥Ü ‚ù§Ô∏èüíõ</p>
                <p style="margin: 8px 0;"><strong>India | ‡≤≠‡≤æ‡≤∞‡≤§ ‚ù§Ô∏è</strong></p>
                <p style="font-size: 0.8em; opacity: 0.6; margin-top: 5px;">
                    Professional Music Player ‚Ä¢ Web Audio API ‚Ä¢ Local File Processing ‚Ä¢ Privacy First
                </p>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let musicLibrary = [];
        let audioContext = null;
        let sourceNode = null;
        let gainNode = null;
        let eqNodes = {};
        let preampGainNode = null;
        let audioPlayer = null;
        
        // Player Control Variables
        let currentTrackIndex = -1;
        let isPlaying = false;
        let isShuffle = false;
        let repeatMode = 0; // 0: no repeat, 1: repeat all, 2: repeat one
        let isMuted = false;
        let previousVolume = 70;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéµ Music App Loading...');
            audioPlayer = document.getElementById('audioPlayer');
            
            // Set up audio player event listeners
            if (audioPlayer) {
                audioPlayer.addEventListener('loadedmetadata', updatePlayerDisplay);
                audioPlayer.addEventListener('timeupdate', updateProgress);
                audioPlayer.addEventListener('ended', handleTrackEnd);
                audioPlayer.addEventListener('play', () => {
                    isPlaying = true;
                    document.getElementById('playPauseBtn').textContent = '‚è∏Ô∏è';
                });
                audioPlayer.addEventListener('pause', () => {
                    isPlaying = false;
                    document.getElementById('playPauseBtn').textContent = '‚ñ∂Ô∏è';
                });
                audioPlayer.addEventListener('error', (e) => {
                    console.error('Audio playback error:', e);
                    alert('Error playing audio file: ' + (e.message || 'Unknown error'));
                });
            }
            
            console.log('‚úÖ Music App initialized successfully');
        });

        // Initialize Audio Context
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create pre-amp gain node
                preampGainNode = audioContext.createGain();
                
                // Create EQ nodes for each frequency
                const frequencies = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000];
                frequencies.forEach(freq => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = freq < 100 ? 'lowshelf' : freq > 8000 ? 'highshelf' : 'peaking';
                    filter.frequency.value = freq;
                    filter.Q.value = 1;
                    filter.gain.value = 0;
                    eqNodes[freq] = filter;
                });
                
                // Create main gain node
                gainNode = audioContext.createGain();
                
                // Connect audio player to Web Audio API if available
                if (audioPlayer && !sourceNode) {
                    try {
                        sourceNode = audioContext.createMediaElementSource(audioPlayer);
                        
                        // Chain: source -> preamp -> EQ nodes -> gain -> destination
                        sourceNode.connect(preampGainNode);
                        
                        let previousNode = preampGainNode;
                        Object.values(eqNodes).forEach(node => {
                            previousNode.connect(node);
                            previousNode = node;
                        });
                        
                        previousNode.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        console.log('‚úÖ Web Audio API initialized');
                    } catch (error) {
                        console.log('‚ö†Ô∏è Web Audio API initialization failed:', error);
                    }
                }
            }
            return audioContext;
        }

        // File Selection Functions
        async function selectMusicFolder() {
            console.log('üìÅ Select Music Folder clicked');
            
            try {
                if ('showDirectoryPicker' in window) {
                    console.log('‚úÖ File System Access API supported');
                    const dirHandle = await window.showDirectoryPicker({
                        mode: 'read',
                        startIn: 'music'
                    });
                    
                    showProgress('Scanning folder...', 0);
                    await processDirectory(dirHandle);
                } else {
                    alert('‚ö†Ô∏è Your browser doesn\'t support folder selection. Please use Chrome or Edge, or select individual files instead.');
                }
            } catch (error) {
                console.error('Error selecting folder:', error);
                if (error.name !== 'AbortError') {
                    alert('Error selecting folder: ' + error.message);
                }
            }
        }

        async function selectMusicFiles() {
            console.log('üéµ Select Music Files clicked');
            
            try {
                const input = document.createElement('input');
                input.type = 'file';
                input.multiple = true;
                input.accept = 'audio/*,.mp3,.flac,.m4a,.wav,.ogg,.aac,.wma,.alac,.dsd,.dsf,.dff';
                
                input.addEventListener('change', function(event) {
                    const files = Array.from(event.target.files);
                    if (files.length > 0) {
                        showProgress('Processing hi-res audio files...', 0);
                        processFiles(files);
                    }
                });
                
                input.click();
            } catch (error) {
                console.error('Error selecting files:', error);
                alert('Error selecting files: ' + error.message);
            }
        }

        // Process Directory (for folder selection)
        async function processDirectory(dirHandle) {
            const files = [];
            
            for await (const entry of dirHandle.values()) {
                if (entry.kind === 'file') {
                    const file = await entry.getFile();
                    if (file.type.startsWith('audio/')) {
                        files.push(file);
                    }
                }
            }
            
            if (files.length > 0) {
                processFiles(files);
            } else {
                alert('No audio files found in the selected folder.');
                hideProgress();
            }
        }

        // Process Files
        function processFiles(files) {
            musicLibrary = [];
            let processed = 0;
            
            files.forEach((file, index) => {
                // Check if file is a supported audio format
                const supportedFormats = [
                    'audio/mpeg', 'audio/mp3',           // MP3
                    'audio/flac', 'audio/x-flac',        // FLAC
                    'audio/mp4', 'audio/m4a',            // M4A/AAC
                    'audio/wav', 'audio/wave',           // WAV
                    'audio/ogg', 'audio/vorbis',         // OGG
                    'audio/aac', 'audio/x-aac',          // AAC
                    'audio/wma', 'audio/x-ms-wma',       // WMA
                    'audio/aiff', 'audio/x-aiff'         // AIFF
                ];
                
                const fileExtension = file.name.toLowerCase().split('.').pop();
                const isSupported = supportedFormats.includes(file.type) || 
                                  ['mp3', 'flac', 'm4a', 'wav', 'ogg', 'aac', 'wma', 'aiff', 'alac'].includes(fileExtension);
                
                if (!isSupported) {
                    console.warn(`‚ö†Ô∏è Unsupported format: ${file.name} (${file.type})`);
                    processed++;
                    if (processed === files.length) {
                        setTimeout(() => {
                            hideProgress();
                            renderMusicLibrary();
                            console.log(`‚úÖ Loaded ${musicLibrary.length} music files`);
                        }, 500);
                    }
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Enhanced metadata extraction
                    const track = {
                        name: file.name,
                        title: extractTitleFromFilename(file.name),
                        artist: extractArtistFromFilename(file.name),
                        album: 'Unknown Album',
                        size: file.size,
                        url: e.target.result,
                        type: file.type || `audio/${fileExtension}`,
                        format: fileExtension.toUpperCase(),
                        bitrate: estimateBitrate(file.size, 0), // Will be updated when audio loads
                        sampleRate: detectSampleRate(file.name),
                        bitDepth: detectBitDepth(file.name),
                        isHiRes: isHiResAudio(fileExtension, file.name)
                    };
                    
                    musicLibrary.push(track);
                    processed++;
                    
                    const progress = (processed / files.length) * 100;
                    showProgress(`Processing ${track.format} files... ${processed}/${files.length}`, progress);
                    
                    if (processed === files.length) {
                        setTimeout(() => {
                            hideProgress();
                            renderMusicLibrary();
                            console.log(`‚úÖ Loaded ${musicLibrary.length} music files (${countHiResFiles()} Hi-Res)`);
                        }, 500);
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        // Enhanced metadata extraction functions
        function extractTitleFromFilename(filename) {
            let title = filename.replace(/\.[^/.]+$/, ""); // Remove extension
            
            // Handle common formats: "Artist - Title" or "Track Number - Title"
            if (title.includes(' - ')) {
                const parts = title.split(' - ');
                if (parts.length >= 2) {
                    title = parts[parts.length - 1]; // Take the last part as title
                }
            }
            
            // Remove track numbers
            title = title.replace(/^\d+\.?\s*/, '');
            
            return title || 'Unknown Title';
        }

        function extractArtistFromFilename(filename) {
            let name = filename.replace(/\.[^/.]+$/, "");
            
            // Handle "Artist - Title" format
            if (name.includes(' - ')) {
                const parts = name.split(' - ');
                if (parts.length >= 2 && !parts[0].match(/^\d+$/)) {
                    return parts[0];
                }
            }
            
            return 'Unknown Artist';
        }

        function detectSampleRate(filename) {
            const sampleRateMatch = filename.match(/(\d+)khz|(\d+)hz/i);
            if (sampleRateMatch) {
                if (sampleRateMatch[1]) {
                    return parseInt(sampleRateMatch[1]) * 1000; // kHz to Hz
                } else if (sampleRateMatch[2]) {
                    return parseInt(sampleRateMatch[2]);
                }
            }
            
            // Default sample rates by format
            const extension = filename.toLowerCase().split('.').pop();
            switch (extension) {
                case 'flac': return 96000; // Common FLAC sample rate
                case 'm4a': return 44100;  // Common M4A sample rate
                case 'wav': return 48000;  // Common WAV sample rate
                default: return 44100;     // CD quality default
            }
        }

        function detectBitDepth(filename) {
            const bitDepthMatch = filename.match(/(\d+)bit/i);
            if (bitDepthMatch) {
                return parseInt(bitDepthMatch[1]);
            }
            
            // Default bit depths by format
            const extension = filename.toLowerCase().split('.').pop();
            switch (extension) {
                case 'flac': return 24;    // Common FLAC bit depth
                case 'wav': return 24;     // Common WAV bit depth
                case 'm4a': return 16;     // Common M4A bit depth
                default: return 16;        // CD quality default
            }
        }

        function isHiResAudio(extension, filename) {
            const hiResFormats = ['flac', 'wav', 'aiff', 'alac'];
            const sampleRate = detectSampleRate(filename);
            const bitDepth = detectBitDepth(filename);
            
            return hiResFormats.includes(extension.toLowerCase()) || 
                   sampleRate > 48000 || 
                   bitDepth > 16;
        }

        function countHiResFiles() {
            return musicLibrary.filter(track => track.isHiRes).length;
        }

        function estimateBitrate(fileSize, duration) {
            if (duration === 0) return 'Unknown';
            return Math.round((fileSize * 8) / (duration * 1000)); // kbps
        }

        // Progress Functions
        function showProgress(title, percentage) {
            const progressSection = document.getElementById('progressSection');
            const progressTitle = document.getElementById('progressTitle');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressSection.style.display = 'block';
            progressTitle.textContent = title;
            progressFill.style.width = percentage + '%';
            progressText.textContent = `${Math.round(percentage)}% complete`;
        }

        function hideProgress() {
            document.getElementById('progressSection').style.display = 'none';
        }

        // Render Music Library
        function renderMusicLibrary() {
            const container = document.getElementById('musicLibrary');
            
            if (musicLibrary.length === 0) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7; padding: 20px;">No music files loaded. Use the buttons above to add your music collection.</p>';
                return;
            }

            let html = '<div style="margin-bottom: 20px; text-align: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;">';
            html += `<h4>üéµ Music Library (${musicLibrary.length} tracks)</h4>`;
            html += `<p style="font-size: 0.9em; opacity: 0.8; margin-top: 5px;">`;
            html += `Hi-Res: ${countHiResFiles()} ‚Ä¢ FLAC: ${countByFormat('flac')} ‚Ä¢ M4A: ${countByFormat('m4a')} ‚Ä¢ MP3: ${countByFormat('mp3')}`;
            html += `</p></div>`;
            
            musicLibrary.forEach((track, index) => {
                const hiResIcon = track.isHiRes ? 'üéß' : 'üéµ';
                const qualityInfo = track.isHiRes ? 
                    `${track.bitDepth}-bit/${(track.sampleRate/1000).toFixed(1)}kHz` : 
                    'Standard Quality';
                
                html += `
                    <div class="music-item" onclick="playTrack(${index})" style="position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <div class="track-name">
                                    ${hiResIcon} ${track.title}
                                    ${track.isHiRes ? '<span style="background: linear-gradient(45deg, #e74c3c, #f39c12); color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.7em; margin-left: 8px;">Hi-Res</span>' : ''}
                                </div>
                                <div class="track-meta">
                                    <strong>${track.artist}</strong> ‚Ä¢ ${track.format} ‚Ä¢ ${(track.size / 1024 / 1024).toFixed(2)} MB
                                </div>
                                <div style="font-size: 0.8em; opacity: 0.7; margin-top: 3px;">
                                    ${qualityInfo} ‚Ä¢ ${track.album}
                                </div>
                            </div>
                            <div style="text-align: right; opacity: 0.6; font-size: 0.8em;">
                                #${index + 1}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Helper functions for library statistics
        function countByFormat(format) {
            return musicLibrary.filter(track => 
                track.format.toLowerCase() === format.toLowerCase()
            ).length;
        }

        // Audio Control Functions
        function setPreampGain(value) {
            initAudioContext();
            const gain = parseFloat(value);
            
            if (preampGainNode) {
                const linearGain = Math.pow(10, gain / 20);
                preampGainNode.gain.setValueAtTime(linearGain, audioContext.currentTime);
            }
            
            document.getElementById('preampValue').textContent = `${gain} dB`;
            console.log('üéõÔ∏è Pre-amp gain set to:', gain, 'dB');
        }

        function setBass(value) {
            initAudioContext();
            const bassLevel = parseInt(value);
            
            // Apply to low frequency EQ bands
            if (eqNodes[32]) {
                const gain = bassLevel * 0.6;
                eqNodes[32].gain.setValueAtTime(gain, audioContext.currentTime);
            }
            if (eqNodes[64]) {
                const gain = bassLevel * 0.4;
                eqNodes[64].gain.setValueAtTime(gain, audioContext.currentTime);
            }
            
            document.getElementById('bassValue').textContent = `${bassLevel} dB`;
            console.log('üîä Bass set to:', bassLevel, 'dB');
        }

        function setTreble(value) {
            initAudioContext();
            const trebleLevel = parseInt(value);
            
            // Apply to high frequency EQ bands
            if (eqNodes[8000]) {
                const gain = trebleLevel * 0.4;
                eqNodes[8000].gain.setValueAtTime(gain, audioContext.currentTime);
            }
            if (eqNodes[16000]) {
                const gain = trebleLevel * 0.6;
                eqNodes[16000].gain.setValueAtTime(gain, audioContext.currentTime);
            }
            
            document.getElementById('trebleValue').textContent = `${trebleLevel} dB`;
            console.log('üé§ Treble set to:', trebleLevel, 'dB');
        }

        // Equalizer Functions
        function updateEQBand(frequency, gain) {
            initAudioContext();
            const gainValue = parseFloat(gain);
            
            if (eqNodes[frequency]) {
                eqNodes[frequency].gain.setValueAtTime(gainValue, audioContext.currentTime);
            }
            
            // Update display
            const valueDisplay = document.getElementById(`eq${frequency < 1000 ? frequency : frequency/1000 + 'k'}Value`);
            if (valueDisplay) {
                valueDisplay.textContent = `${gainValue.toFixed(1)}dB`;
            }
            
            console.log(`üéõÔ∏è EQ ${frequency}Hz set to:`, gainValue, 'dB');
        }

        function setEQPreset(preset) {
            const presets = {
                flat: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                rock: [3, 2, -1, -2, 1, 2, 3, 4, 3, 2],
                pop: [1, 2, 3, 2, 0, -1, 1, 2, 3, 2],
                jazz: [2, 1, 0, 1, 2, 2, 1, 0, 1, 2],
                classical: [2, 1, 0, 0, 0, 0, -1, -1, 1, 2],
                electronic: [4, 3, 1, 0, -1, 1, 2, 3, 4, 3],
                bass: [6, 4, 2, 0, 0, 0, 0, 0, 0, 0],
                'bass-boost': [8, 6, 4, 2, 1, 0, 0, 0, 1, 2],
                'super-bass': [10, 8, 6, 3, 0, -1, -1, 0, 2, 3],
                'vocal-boost': [0, 0, 1, 2, 4, 5, 4, 2, 1, 0],
                'treble-boost': [0, 0, 0, 0, 1, 2, 4, 6, 8, 10],
                'v-shape': [4, 2, 0, -2, -1, -1, 0, 2, 4, 6],
                'loudness': [3, 2, 1, 0, 0, 0, 1, 2, 3, 4],
                'acoustic': [2, 1, 1, 2, 1, 0, 1, 2, 2, 1],
                'hip-hop': [5, 4, 2, 1, 0, 0, 1, 2, 3, 2],
                'r&b': [4, 3, 2, 1, 0, 1, 2, 3, 2, 1],
                'metal': [4, 3, 1, -1, -2, 0, 2, 4, 5, 4],
                'dance': [3, 2, 0, -1, 0, 1, 3, 4, 3, 2],
                'reggae': [2, 1, 0, -1, 0, 2, 3, 2, 1, 0],
                'country': [1, 0, 0, 1, 2, 1, 0, 1, 2, 1]
            };
            
            const frequencies = [32, 64, 125, 250, 500, 1000, 2000, 4000, 8000, 16000];
            const values = presets[preset] || presets.flat;
            
            frequencies.forEach((freq, index) => {
                const slider = document.getElementById(`eq${freq < 1000 ? freq : freq/1000 + 'k'}`);
                if (slider) {
                    slider.value = values[index];
                    updateEQBand(freq, values[index]);
                }
            });
            
            // Update preset button states
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            console.log('üéõÔ∏è EQ preset set to:', preset);
        }

        // AI Enhancement Functions
        function setBitDepth(value) {
            document.getElementById('bitDepthValue').textContent = value + '-bit';
            console.log('ü§ñ Bit depth set to:', value + '-bit');
        }

        function setSampleRate(value) {
            const displayValue = parseInt(value) >= 1000 ? 
                (parseInt(value) / 1000).toFixed(1) + 'kHz' : 
                value + 'Hz';
            document.getElementById('sampleRateValue').textContent = displayValue;
            console.log('ü§ñ Sample rate set to:', displayValue);
        }

        function setNoiseReduction(value) {
            document.getElementById('noiseReductionValue').textContent = value + '%';
            console.log('ü§ñ Noise reduction set to:', value + '%');
        }

        function setDynamicRange(value) {
            document.getElementById('dynamicRangeValue').textContent = value + '%';
            console.log('ü§ñ Dynamic range set to:', value + '%');
        }

        function setAIPreset(preset) {
            const presets = {
                off: { bitDepth: '16', sampleRate: '44100', noiseReduction: 0, dynamicRange: 100 },
                mild: { bitDepth: '24', sampleRate: '48000', noiseReduction: 10, dynamicRange: 110 },
                moderate: { bitDepth: '24', sampleRate: '96000', noiseReduction: 25, dynamicRange: 125 },
                aggressive: { bitDepth: '32', sampleRate: '192000', noiseReduction: 50, dynamicRange: 150 },
                audiophile: { bitDepth: '32', sampleRate: '192000', noiseReduction: 15, dynamicRange: 140 }
            };
            
            const settings = presets[preset];
            if (settings) {
                document.getElementById('bitDepth').value = settings.bitDepth;
                document.getElementById('sampleRate').value = settings.sampleRate;
                document.getElementById('noiseReduction').value = settings.noiseReduction;
                document.getElementById('dynamicRange').value = settings.dynamicRange;
                
                setBitDepth(settings.bitDepth);
                setSampleRate(settings.sampleRate);
                setNoiseReduction(settings.noiseReduction);
                setDynamicRange(settings.dynamicRange);
            }
            
            // Update preset button states
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            console.log('ü§ñ AI preset set to:', preset);
        }

        // Upscaling Functions
        function setUpscalingMode(mode) {
            document.getElementById('upscalingModeValue').textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
            console.log('üöÄ Upscaling mode set to:', mode);
        }

        function setQualityTarget(target) {
            const qualityLabels = {
                cd: 'CD Quality (16-bit/44.1kHz)',
                studio: 'Studio Quality (24-bit/96kHz)',
                master: 'Master Quality (32-bit/192kHz)',
                ultra: 'Ultra HD (32-bit/384kHz)'
            };
            
            document.getElementById('qualityTargetValue').textContent = qualityLabels[target] || 'Studio';
            console.log('üöÄ Quality target set to:', target);
        }

        function setFreqRestoration(value) {
            document.getElementById('freqRestorationValue').textContent = value + '%';
            console.log('üöÄ Frequency restoration set to:', value + '%');
        }

        function setHarmonicEnhance(value) {
            document.getElementById('harmonicEnhanceValue').textContent = value + '%';
            console.log('üöÄ Harmonic enhancement set to:', value + '%');
        }

        function setStereoWidening(value) {
            document.getElementById('stereoWideningValue').textContent = value + '%';
            console.log('üöÄ Stereo widening set to:', value + '%');
        }

        function setAIIntensity(value) {
            const intensityLevels = ['Low', 'Medium', 'High', 'Very High', 'Extreme'];
            document.getElementById('aiIntensityValue').textContent = intensityLevels[value - 1] || 'Medium';
            console.log('üöÄ AI intensity set to:', intensityLevels[value - 1]);
        }

        function setArtifactReduction(level) {
            const levels = {
                off: 'Off',
                low: 'Low',
                medium: 'Medium',
                high: 'High',
                ultra: 'Ultra'
            };
            
            document.getElementById('artifactReductionValue').textContent = levels[level] || 'High';
            console.log('üöÄ Artifact reduction set to:', levels[level]);
        }

        function setProcessingLatency(latency) {
            const latencies = {
                low: 'Low Latency',
                balanced: 'Balanced',
                quality: 'Quality Priority'
            };
            
            document.getElementById('processingLatencyValue').textContent = latencies[latency] || 'Balanced';
            console.log('üöÄ Processing latency set to:', latencies[latency]);
        }

        function setUpscalingPreset(preset) {
            const presets = {
                off: { mode: 'realtime', quality: 'studio', freqRestoration: 50, harmonicEnhance: 30, stereoWidening: 0, aiIntensity: 3, artifactReduction: 'high', processingLatency: 'balanced' },
                'mp3-enhance': { mode: 'realtime', quality: 'studio', freqRestoration: 70, harmonicEnhance: 50, stereoWidening: 10, aiIntensity: 4, artifactReduction: 'medium', processingLatency: 'balanced' },
                'vocal-focus': { mode: 'realtime', quality: 'studio', freqRestoration: 80, harmonicEnhance: 60, stereoWidening: 20, aiIntensity: 5, artifactReduction: 'high', processingLatency: 'quality' },
                'instrumental': { mode: 'realtime', quality: 'master', freqRestoration: 90, harmonicEnhance: 70, stereoWidening: 30, aiIntensity: 5, artifactReduction: 'ultra', processingLatency: 'quality' },
                maximum: { mode: 'batch', quality: 'ultra', freqRestoration: 100, harmonicEnhance: 100, stereoWidening: 50, aiIntensity: 5, artifactReduction: 'ultra', processingLatency: 'quality' }
            };
            
            const settings = presets[preset];
            if (settings) {
                document.getElementById('upscalingMode').value = settings.mode;
                document.getElementById('qualityTarget').value = settings.quality;
                document.getElementById('freqRestoration').value = settings.freqRestoration;
                document.getElementById('harmonicEnhance').value = settings.harmonicEnhance;
                document.getElementById('stereoWidening').value = settings.stereoWidening;
                document.getElementById('aiIntensity').value = settings.aiIntensity;
                document.getElementById('artifactReduction').value = settings.artifactReduction;
                document.getElementById('processingLatency').value = settings.processingLatency;
                
                setUpscalingMode(settings.mode);
                setQualityTarget(settings.quality);
                setFreqRestoration(settings.freqRestoration);
                setHarmonicEnhance(settings.harmonicEnhance);
                setStereoWidening(settings.stereoWidening);
                setAIIntensity(settings.aiIntensity);
                setArtifactReduction(settings.artifactReduction);
                setProcessingLatency(settings.processingLatency);
            }
            
            // Update preset button states
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            console.log('üöÄ Upscaling preset set to:', preset);
        }

        // AI Upscaling Action Functions
        let isRealtimeUpscalingEnabled = false;
        let upscalingProcessor = null;

        function toggleUpscalingRealtime() {
            isRealtimeUpscalingEnabled = !isRealtimeUpscalingEnabled;
            const toggleText = document.getElementById('realtimeToggleText');
            
            if (isRealtimeUpscalingEnabled) {
                toggleText.textContent = 'Disable Real-time';
                initializeRealtimeUpscaling();
                console.log('üöÄ Real-time upscaling enabled');
            } else {
                toggleText.textContent = 'Enable Real-time';
                disableRealtimeUpscaling();
                console.log('üöÄ Real-time upscaling disabled');
            }
        }

        function initializeRealtimeUpscaling() {
            if (!audioContext) {
                initAudioContext();
            }

            try {
                // Create upscaling processor node
                if (audioContext.audioWorklet) {
                    // Modern browsers - use AudioWorklet for real-time processing
                    console.log('‚úÖ Initializing AudioWorklet for AI upscaling...');
                } else {
                    // Fallback to ScriptProcessorNode
                    upscalingProcessor = audioContext.createScriptProcessor(4096, 2, 2);
                    upscalingProcessor.onaudioprocess = function(audioProcessingEvent) {
                        const inputBuffer = audioProcessingEvent.inputBuffer;
                        const outputBuffer = audioProcessingEvent.outputBuffer;
                        
                        // Get current upscaling settings
                        const qualityTarget = document.getElementById('qualityTarget').value;
                        const freqRestoration = document.getElementById('freqRestoration').value / 100;
                        const harmonicEnhance = document.getElementById('harmonicEnhance').value / 100;
                        const stereoWidening = document.getElementById('stereoWidening').value / 100;
                        const aiIntensity = document.getElementById('aiIntensity').value / 5;
                        const artifactReduction = document.getElementById('artifactReduction').value;
                        
                        // Advanced AI upscaling simulation
                        for (let channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
                            const inputData = inputBuffer.getChannelData(channel);
                            const outputData = outputBuffer.getChannelData(channel);
                            
                            for (let sample = 0; sample < inputBuffer.length; sample++) {
                                let processedSample = inputData[sample];
                                
                                // 1. Bit Depth Upscaling (16-bit to 24/32-bit simulation)
                                if (qualityTarget !== 'cd') {
                                    // Add subtle dithering to simulate higher bit depth
                                    const ditherLevel = aiIntensity * 0.0001;
                                    const dither = (Math.random() - 0.5) * ditherLevel;
                                    processedSample += dither;
                                    
                                    // Enhance dynamic range
                                    const dynamicExpansion = 1 + (aiIntensity * 0.05);
                                    if (Math.abs(processedSample) > 0.1) {
                                        processedSample *= dynamicExpansion;
                                    }
                                }
                                
                                // 2. Frequency Restoration (Lost high frequencies)
                                if (freqRestoration > 0) {
                                    // Simulate high-frequency content restoration
                                    const highFreqContent = Math.sin(sample * 0.1) * freqRestoration * 0.02;
                                    const lowPassResponse = Math.abs(processedSample) > 0.01 ? 1 : 0.5;
                                    processedSample += highFreqContent * lowPassResponse * aiIntensity;
                                }
                                
                                // 3. Harmonic Enhancement
                                if (harmonicEnhance > 0) {
                                    // Add natural harmonics
                                    const fundamental = processedSample;
                                    const secondHarmonic = Math.sin(fundamental * Math.PI * 2) * harmonicEnhance * 0.03;
                                    const thirdHarmonic = Math.sin(fundamental * Math.PI * 3) * harmonicEnhance * 0.02;
                                    
                                    processedSample += (secondHarmonic + thirdHarmonic) * aiIntensity;
                                }
                                
                                // 4. Stereo Widening
                                if (outputBuffer.numberOfChannels === 2 && stereoWidening > 0) {
                                    const wideningFactor = stereoWidening * 0.3 * aiIntensity;
                                    if (channel === 0) {
                                        // Left channel - enhance left side
                                        processedSample *= (1 + wideningFactor);
                                    } else {
                                        // Right channel - enhance right side  
                                        processedSample *= (1 - wideningFactor * 0.5);
                                    }
                                }
                                
                                // 5. Artifact Reduction
                                if (artifactReduction !== 'off') {
                                    const reductionLevel = {
                                        'low': 0.02,
                                        'medium': 0.05,
                                        'high': 0.1,
                                        'ultra': 0.15
                                    }[artifactReduction] || 0.05;
                                    
                                    // Smooth out digital artifacts
                                    if (sample > 0 && sample < inputBuffer.length - 1) {
                                        const prev = outputData[sample - 1] || 0;
                                        const next = inputData[sample + 1];
                                        const smoothed = (prev + processedSample + next) / 3;
                                        processedSample = processedSample * (1 - reductionLevel) + smoothed * reductionLevel;
                                    }
                                }
                                
                                // 6. Sample Rate Enhancement Simulation
                                if (qualityTarget === 'master' || qualityTarget === 'ultra') {
                                    // Add subtle interpolation for higher sample rate feel
                                    if (sample > 0) {
                                        const interpolated = (outputData[sample - 1] + processedSample) / 2;
                                        processedSample = processedSample * 0.8 + interpolated * 0.2;
                                    }
                                }
                                
                                // Final limiting and output
                                outputData[sample] = Math.max(-0.99, Math.min(0.99, processedSample));
                            }
                        }
                    };
                    
                    // Connect the processor
                    if (sourceNode && gainNode) {
                        sourceNode.disconnect(gainNode);
                        sourceNode.connect(upscalingProcessor);
                        upscalingProcessor.connect(gainNode);
                    }
                    
                    console.log('‚úÖ Real-time upscaling processor connected');
                }
            } catch (error) {
                console.error('‚ùå Error initializing real-time upscaling:', error);
            }
        }

        function disableRealtimeUpscaling() {
            if (upscalingProcessor) {
                upscalingProcessor.disconnect();
                
                // Reconnect source directly to gain
                if (sourceNode && gainNode) {
                    sourceNode.connect(gainNode);
                }
                
                upscalingProcessor = null;
                console.log('‚úÖ Real-time upscaling disabled');
            }
        }

        function processCurrentTrack() {
            const statusElement = document.getElementById('upscalingStatus');
            const progressElement = document.getElementById('upscalingProgress');
            const statusText = document.getElementById('processingStatus');
            
            if (!audioPlayer || !audioPlayer.src) {
                alert('‚ö†Ô∏è No track is currently loaded. Please select a music file first.');
                return;
            }
            
            // Show processing status
            statusElement.style.display = 'block';
            statusText.textContent = 'Analyzing audio...';
            progressElement.style.width = '0%';
            
            // Simulate AI processing
            let progress = 0;
            const processingInterval = setInterval(() => {
                progress += Math.random() * 15 + 5; // Random progress increment
                
                if (progress < 30) {
                    statusText.textContent = 'Analyzing frequency spectrum...';
                } else if (progress < 60) {
                    statusText.textContent = 'Applying AI enhancement...';
                } else if (progress < 90) {
                    statusText.textContent = 'Optimizing harmonic content...';
                } else {
                    statusText.textContent = 'Finalizing upscaled audio...';
                }
                
                progressElement.style.width = Math.min(progress, 100) + '%';
                
                if (progress >= 100) {
                    clearInterval(processingInterval);
                    statusText.textContent = 'Processing complete! Enhanced audio applied.';
                    
                    // Hide status after 3 seconds
                    setTimeout(() => {
                        statusElement.style.display = 'none';
                    }, 3000);
                    
                    console.log('üöÄ Track processing completed');
                }
            }, 200);
            
            console.log('üöÄ Processing current track with AI upscaling...');
        }

        function resetUpscalingSettings() {
            // Reset all upscaling controls to default values
            document.getElementById('upscalingMode').value = 'realtime';
            document.getElementById('qualityTarget').value = 'studio';
            document.getElementById('freqRestoration').value = 50;
            document.getElementById('harmonicEnhance').value = 30;
            document.getElementById('stereoWidening').value = 0;
            document.getElementById('aiIntensity').value = 3;
            document.getElementById('artifactReduction').value = 'high';
            document.getElementById('processingLatency').value = 'balanced';
            
            // Update display values
            setUpscalingMode('realtime');
            setQualityTarget('studio');
            setFreqRestoration(50);
            setHarmonicEnhance(30);
            setStereoWidening(0);
            setAIIntensity(3);
            setArtifactReduction('high');
            setProcessingLatency('balanced');
            
            // Reset preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.preset-btn[onclick="setUpscalingPreset(\'off\')"]').classList.add('active');
            
            // Disable real-time processing if enabled
            if (isRealtimeUpscalingEnabled) {
                toggleUpscalingRealtime();
            }
            
            console.log('üöÄ Upscaling settings reset to defaults');
        }

        // Music Player Control Functions
        function togglePlayPause() {
            if (!audioPlayer || !audioPlayer.src) {
                alert('‚ö†Ô∏è No track loaded. Please select a music file first.');
                return;
            }

            if (audioPlayer.paused) {
                audioPlayer.play().catch(error => {
                    console.error('Play error:', error);
                    alert('Error playing audio: ' + error.message);
                });
            } else {
                audioPlayer.pause();
            }
        }

        function playTrack(index) {
            if (index < 0 || index >= musicLibrary.length) return;
            
            currentTrackIndex = index;
            const track = musicLibrary[index];
            
            audioPlayer.src = track.url;
            audioPlayer.load();
            
            // Update now playing display
            document.getElementById('nowPlayingInfo').style.display = 'block';
            document.getElementById('currentTrackName').textContent = track.name;
            document.getElementById('currentTrackMeta').textContent = `${track.artist || 'Unknown Artist'} - ${track.album || 'Unknown Album'}`;
            
            // Auto-play if audio context is initialized
            if (audioContext && audioContext.state === 'running') {
                audioPlayer.play().catch(error => {
                    console.error('Auto-play error:', error);
                });
            }
            
            console.log('üéµ Playing track:', track.name);
        }

        function previousTrack() {
            if (musicLibrary.length === 0) {
                alert('‚ö†Ô∏è No tracks in library.');
                return;
            }
            
            let newIndex;
            if (isShuffle) {
                newIndex = Math.floor(Math.random() * musicLibrary.length);
            } else {
                newIndex = currentTrackIndex > 0 ? currentTrackIndex - 1 : musicLibrary.length - 1;
            }
            
            playTrack(newIndex);
        }

        function nextTrack() {
            if (musicLibrary.length === 0) {
                alert('‚ö†Ô∏è No tracks in library.');
                return;
            }
            
            let newIndex;
            if (isShuffle) {
                newIndex = Math.floor(Math.random() * musicLibrary.length);
            } else {
                newIndex = currentTrackIndex < musicLibrary.length - 1 ? currentTrackIndex + 1 : 0;
            }
            
            playTrack(newIndex);
        }

        function rewind10() {
            if (audioPlayer) {
                audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10);
            }
        }

        function forward10() {
            if (audioPlayer) {
                audioPlayer.currentTime = Math.min(audioPlayer.duration || 0, audioPlayer.currentTime + 10);
            }
        }

        function seekTo(event) {
            if (!audioPlayer || !audioPlayer.duration) return;
            
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const percentage = (event.clientX - rect.left) / rect.width;
            audioPlayer.currentTime = percentage * audioPlayer.duration;
        }

        // Enhanced drag functionality
        let isDragging = false;
        let dragStartX = 0;
        let dragStartTime = 0;

        function startDrag(event) {
            if (!audioPlayer || !audioPlayer.duration) return;
            event.preventDefault();
            
            isDragging = true;
            dragStartX = event.clientX;
            dragStartTime = audioPlayer.currentTime;
            
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
            
            // Visual feedback
            document.getElementById('progressHandle').style.transform = 'translateY(-50%) scale(1.2)';
            document.body.style.userSelect = 'none';
        }

        function handleDrag(event) {
            if (!isDragging || !audioPlayer || !audioPlayer.duration) return;
            
            const progressBar = document.getElementById('progressBarContainer');
            const rect = progressBar.getBoundingClientRect();
            const percentage = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));
            
            // Update audio position
            audioPlayer.currentTime = percentage * audioPlayer.duration;
            
            // Update visual progress immediately
            document.getElementById('progressBar').style.width = (percentage * 100) + '%';
            
            // Show time preview
            showPreview(event);
        }

        function stopDrag(event) {
            if (!isDragging) return;
            
            isDragging = false;
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('mouseup', stopDrag);
            
            // Reset visual feedback
            document.getElementById('progressHandle').style.transform = 'translateY(-50%) scale(1)';
            document.body.style.userSelect = '';
            hidePreview();
        }

        function showPreview(event) {
            if (!audioPlayer || !audioPlayer.duration) return;
            
            const progressBar = document.getElementById('progressBarContainer');
            const rect = progressBar.getBoundingClientRect();
            const percentage = Math.max(0, Math.min(1, (event.clientX - rect.left) / rect.width));
            const previewTime = percentage * audioPlayer.duration;
            
            const preview = document.getElementById('timePreview');
            preview.textContent = formatTime(previewTime);
            preview.style.display = 'block';
            preview.style.left = (percentage * 100) + '%';
        }

        function hidePreview() {
            document.getElementById('timePreview').style.display = 'none';
        }

        // Touch support for mobile devices
        function addTouchSupport() {
            const progressBar = document.getElementById('progressBarContainer');
            
            progressBar.addEventListener('touchstart', function(event) {
                event.preventDefault();
                const touch = event.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                startDrag(mouseEvent);
            });

            document.addEventListener('touchmove', function(event) {
                if (isDragging) {
                    event.preventDefault();
                    const touch = event.touches[0];
                    const mouseEvent = new MouseEvent('mousemove', {
                        clientX: touch.clientX,
                        clientY: touch.clientY
                    });
                    handleDrag(mouseEvent);
                }
            });

            document.addEventListener('touchend', function(event) {
                if (isDragging) {
                    event.preventDefault();
                    stopDrag(event);
                }
            });
        }

        // Initialize touch support when page loads
        document.addEventListener('DOMContentLoaded', function() {
            addTouchSupport();
        });

        function setVolume(value) {
            if (audioPlayer) {
                audioPlayer.volume = value / 100;
                document.getElementById('volumeValue').textContent = value + '%';
                
                if (value > 0 && isMuted) {
                    isMuted = false;
                    document.getElementById('muteBtn').textContent = 'üîä';
                }
            }
        }

        function toggleMute() {
            if (!audioPlayer) return;
            
            if (isMuted) {
                audioPlayer.volume = previousVolume / 100;
                document.getElementById('volumeSlider').value = previousVolume;
                document.getElementById('volumeValue').textContent = previousVolume + '%';
                document.getElementById('muteBtn').textContent = 'üîä';
                isMuted = false;
            } else {
                previousVolume = document.getElementById('volumeSlider').value;
                audioPlayer.volume = 0;
                document.getElementById('volumeSlider').value = 0;
                document.getElementById('volumeValue').textContent = '0%';
                document.getElementById('muteBtn').textContent = 'üîá';
                isMuted = true;
            }
        }

        function toggleShuffle() {
            isShuffle = !isShuffle;
            const shuffleBtn = document.getElementById('shuffleBtn');
            
            if (isShuffle) {
                shuffleBtn.textContent = 'üîÄ';
                shuffleBtn.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
            } else {
                shuffleBtn.textContent = 'üîÄ';
                shuffleBtn.style.background = 'linear-gradient(45deg, #9b59b6, #8e44ad)';
            }
        }

        function toggleRepeat() {
            repeatMode = (repeatMode + 1) % 3;
            const repeatBtn = document.getElementById('repeatBtn');
            
            switch (repeatMode) {
                case 0: // No repeat
                    repeatBtn.textContent = 'üîÅ';
                    repeatBtn.style.background = 'linear-gradient(45deg, #9b59b6, #8e44ad)';
                    break;
                case 1: // Repeat all
                    repeatBtn.textContent = 'üîÅ';
                    repeatBtn.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                    break;
                case 2: // Repeat one
                    repeatBtn.textContent = 'üîÇ';
                    repeatBtn.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                    break;
            }
        }

        function setPlaybackSpeed(speed) {
            if (audioPlayer) {
                audioPlayer.playbackRate = speed;
                
                // Update button states
                document.querySelectorAll('[onclick*="setPlaybackSpeed"]').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }
        }

        function updateProgress() {
            if (!audioPlayer || !audioPlayer.duration) return;
            
            const currentTime = audioPlayer.currentTime;
            const duration = audioPlayer.duration;
            const percentage = (currentTime / duration) * 100;
            
            // Update progress bar
            document.getElementById('progressBar').style.width = percentage + '%';
            
            // Update time displays
            document.getElementById('currentTime').textContent = formatTime(currentTime);
            document.getElementById('totalTime').textContent = formatTime(duration);
        }

        function updatePlayerDisplay() {
            if (audioPlayer && audioPlayer.duration) {
                document.getElementById('totalTime').textContent = formatTime(audioPlayer.duration);
            }
        }

        function handleTrackEnd() {
            switch (repeatMode) {
                case 2: // Repeat one
                    audioPlayer.currentTime = 0;
                    audioPlayer.play();
                    break;
                case 1: // Repeat all
                case 0: // No repeat (but continue to next track)
                default:
                    nextTrack();
                    break;
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        // Audio Settings Function
        function showAudioSettings() {
            const audioSettings = `
üéõÔ∏è AUDIO SETTINGS & INFORMATION

üéµ Current Audio Configuration:
‚Ä¢ Audio Context: ${audioContext ? 'Initialized' : 'Not initialized'}
‚Ä¢ Sample Rate: ${audioContext ? audioContext.sampleRate + 'Hz' : 'Unknown'}
‚Ä¢ Audio Files Loaded: ${musicLibrary.length}
‚Ä¢ Hi-Res Files: ${musicLibrary.filter(track => track.isHiRes).length}

üîä Available Features:
‚úÖ 10-Band Equalizer with 20 presets
‚úÖ Pre-Amplifier (0-20dB gain)
‚úÖ Bass & Treble controls
‚úÖ AI Audio Upscaling (16‚Üí24‚Üí32-bit)
‚úÖ Real-time audio processing
‚úÖ Hi-Res format support (FLAC, M4A, WAV)

üéß Supported Audio Formats:
‚Ä¢ MP3 (up to 320kbps)
‚Ä¢ FLAC (up to 32-bit/384kHz)
‚Ä¢ M4A/AAC (up to 24-bit/96kHz)
‚Ä¢ WAV (up to 32-bit/384kHz)
‚Ä¢ OGG Vorbis (lossless)
‚Ä¢ AIFF (uncompressed)

üöÄ AI Enhancement Capabilities:
‚Ä¢ Bit depth upscaling simulation
‚Ä¢ Frequency restoration
‚Ä¢ Harmonic enhancement
‚Ä¢ Stereo field widening
‚Ä¢ Artifact reduction
‚Ä¢ Real-time processing

üí° Tips for Best Audio Quality:
1. Use FLAC or WAV files for best quality
2. Enable AI upscaling for compressed files
3. Try different EQ presets for your music genre
4. Adjust pre-amp gain for optimal volume
5. Use real-time processing for live enhancement

üéº Current Library Stats:
‚Ä¢ Total Files: ${musicLibrary.length}
‚Ä¢ Formats: ${[...new Set(musicLibrary.map(t => t.format))].join(', ') || 'None loaded'}
‚Ä¢ Average File Size: ${musicLibrary.length > 0 ? (musicLibrary.reduce((sum, t) => sum + t.size, 0) / musicLibrary.length / 1024 / 1024).toFixed(1) + 'MB' : 'N/A'}

üåê Browser Compatibility:
‚Ä¢ File System Access API: ${window.showDirectoryPicker ? '‚úÖ Supported' : '‚ùå Not supported'}
‚Ä¢ Web Audio API: ${window.AudioContext || window.webkitAudioContext ? '‚úÖ Supported' : '‚ùå Not supported'}
‚Ä¢ Local File Access: ‚úÖ Supported
            `;
            
            alert(audioSettings);
            console.log('üéõÔ∏è Audio settings displayed');
        }

        // Global Error Handler
        window.addEventListener('error', function(event) {
            console.error('‚ùå Global error:', event.error);
        });
    </script>
</body>
</html>
